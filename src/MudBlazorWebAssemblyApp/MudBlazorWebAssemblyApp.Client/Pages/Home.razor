@page "/"
@using Blazored.LocalStorage
@inject ILocalStorageService Storage;
@inject IJSRuntime JS

<PageTitle>Home</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Hello, world!</MudText>
<MudText Class="mb-8">Welcome to your new app, powered by MudBlazor and the .NET 9 Template!</MudText>

<MudButton Variant="Variant.Filled" StartIcon="@Icons.Custom.Uncategorized.Radioactive" Color="Color.Warning" @onclick=@ShowAlert>Warning</MudButton>

<MudButton Variant="Variant.Filled" StartIcon="@Icons.Custom.Uncategorized.Bacteria" Color="Color.Dark" @onclick=@ShowLogConsole>Log To Console</MudButton>

<MudSwitch Label="Zgoda na ciasteczka" @bind-value="@AcceptCookies" Color="Color.Primary" />




<MudButton Variant="Variant.Filled" StartIcon="@Icons.Custom.Uncategorized.Bacteria" Color="Color.Dark" @onclick=@SaveAccept>Zapisz zgode</MudButton>

<MudButton Variant="Variant.Filled" StartIcon="@Icons.Custom.Uncategorized.Bacteria" Color="Color.Dark" @onclick=@LoadAccept>Pobierz zgode</MudButton>


<MudButton Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Train" Color="Color.Dark"
           @onclick=@GetGeolocation>Pobierz lokalizację</MudButton>


<MudText Typo="Typo.h5">lat: @Latitude lng: @Longitude</MudText>



@code {

    private bool AcceptCookies;

    private async Task ShowAlert()
    {
        //  await JS.InvokeVoidAsync("alert", "Hello World!");
    }

    private async Task ShowLogConsole()
    {
        // Console.WriteLine("Hello World!");
        // await JS.InvokeVoidAsync("console.log", "Hello World!");

        // await JS.InvokeVoidAsync("x++");

    }


    // localStorage.setItem("accept-cookies", "true");
    private async Task SaveAccept()
    {        
        await Storage.SetItemAsync("accept-cookies", AcceptCookies);
    }

    // localStorage.getItem("accept-cookies");
    private async Task LoadAccept()
    {   
        AcceptCookies = await Storage.GetItemAsync<bool>("accept-cookies");
    }   

    private async Task GetGeolocation()
    {
        Console.WriteLine("Pobierz lokalizacje...");

        await JS.InvokeVoidAsync("getLocation", _dotnetRef);
    }

    private DotNetObjectReference<Home> _dotnetRef;

    protected override void OnInitialized()
    {
        _dotnetRef = DotNetObjectReference.Create(this);
    }

    private double Latitude { get; set; }
    private double Longitude { get; set; }

    [JSInvokable]
    public void OnLocationChanged(double latitude, double longitude)
    {
        Console.WriteLine($"{latitude} {longitude}");

        Latitude = latitude;
        Longitude = longitude;

        StateHasChanged();
    }


}